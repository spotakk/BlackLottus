-----------------------------------------------------------------------------------------------------------------------------------------
-- VRP
-----------------------------------------------------------------------------------------------------------------------------------------
local Tunnel = module("vrp","lib/Tunnel")
-----------------------------------------------------------------------------------------------------------------------------------------
-- CONNECTION
-----------------------------------------------------------------------------------------------------------------------------------------
cRP = {}
Tunnel.bindInterface("shops",cRP)
vSERVER = Tunnel.getInterface("shops")
-----------------------------------------------------------------------------------------------------------------------------------------
-- CLOSE
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("close",function(data)
	SetNuiFocus(false,false)
	SendNUIMessage({ action = "hideNUI" })
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- REQUESTSHOP
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("requestShop",function(data,cb)
	local inventoryShop,inventoryUser,invPeso,invMaxpeso,shopSlots,playerName,playerId = vSERVER.requestShop(data["shop"])
	if inventoryShop then
		cb({ inventoryShop = inventoryShop, inventoryUser = inventoryUser, invPeso = invPeso, invMaxpeso = invMaxpeso, shopSlots = shopSlots,name = playerName,id = playerId })
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- REQUESTBUY
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("functionShops",function(data)
	if MumbleIsConnected() then
		vSERVER.functionShops(data["shop"],data["item"],data["amount"],data["slot"])
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- POPULATESLOT
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("populateSlot",function(data)
	if MumbleIsConnected() then
		TriggerServerEvent("shops:populateSlot",data["item"],data["slot"],data["target"],data["amount"])
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- UPDATESLOT
-----------------------------------------------------------------------------------------------------------------------------------------
RegisterNUICallback("updateSlot",function(data)
	if MumbleIsConnected() then
		TriggerServerEvent("shops:updateSlot",data["item"],data["slot"],data["target"],data["amount"])
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- TRUNKCHEST:UPDATE
-----------------------------------------------------------------------------------------------------------------------------------------
function cRP.updateShops(action)
	SendNUIMessage({ action = action })
end
-----------------------------------------------------------------------------------------------------------------------------------------
-- SHOPLIST
-----------------------------------------------------------------------------------------------------------------------------------------
local shopList = {
	{ -551.1,-191.07,38.22,"Identity",false },
	{ -553.3,-192.34,38.22,"Identity",false },
	{ -544.33,-185.59,52.2,"Identity2",false },
-----------------------------------------------------------------------------------------------------------------------------------------
-- LOJA DE DEPARTAMENTO
-----------------------------------------------------------------------------------------------------------------------------------------
	{ 25.72,-1346.22,29.49,"Departament",true },
	{ 2556.48,382.09,108.61,"Departament",true },
	{ 1164.82,-323.63,69.2,"Departament",true },
	{ -706.16,-914.55,19.21,"Departament",true },
	{ -47.39,-1758.63,29.42,"Departament",true },
	{ 373.94,326.99,103.56,"Departament",true },
	{ -3243.03,1001.33,12.82,"Departament",true },
	{ 1729.3,6415.39,35.03,"Departament",true },
	{ 547.9,2670.4,42.16,"Departament",true },
	{ 1960.66,3741.37,32.33,"Departament",true },
	{ 2677.97,3280.83,55.23,"Departament",true },
	{ 1697.35,4923.46,42.06,"Departament",true },
	{ -1819.55,793.51,138.08,"Departament",true },
	{ 1392.03,3606.1,34.98,"Departament",true },
	{ -2966.41,391.59,15.05,"Departament",true },
	{ -3040.18,585.49,7.9,"Departament",true },
	{ 1134.33,-983.09,46.4,"Departament",true },
	{ 1165.26,2710.79,38.15,"Departament",true },
	{ -1486.77,-377.56,40.15,"Departament",true },
	{ -1221.42,-907.91,12.32,"Departament",true },
-----------------------------------------------------------------------------------------------------------------------------------------
-- LOJA DE ARMAS
-----------------------------------------------------------------------------------------------------------------------------------------
	{ 1692.28,3760.94,34.69,"Ammunation",false },
	{ 253.79,-50.5,69.94,"Ammunation",false },
	{ 842.41,-1035.28,28.19,"Ammunation",false },
	{ -331.62,6084.93,31.46,"Ammunation",false },
	{ -662.29,-933.62,21.82,"Ammunation",false },
	{ -1304.17,-394.62,36.7,"Ammunation",false },
	{ -1118.95,2699.73,18.55,"Ammunation",false },
	{ 2567.98,292.65,108.73,"Ammunation",false },
	{ -3173.51,1088.38,20.84,"Ammunation",false },
	{ 22.59,-1105.54,29.79,"Ammunation",false },
	{ 810.22,-2158.99,29.62,"Ammunation",false },
-----------------------------------------------------------------------------------------------------------------------------------------
-- ORGANIZAÇÕES LEGAIS
-----------------------------------------------------------------------------------------------------------------------------------------
	{ -172.87,6381.21,31.48,"Pharmacy",false }, 
	{ 1690.07,3581.68,35.62,"Pharmacy",false },
	{ 326.5,-1074.43,29.47,"Pharmacy",false },
	{ 114.62,-5.3,67.82,"Pharmacy",false },
	{-452.05,-324.4,34.91,"Paramedic",false }, 
	{ 1822.70,3686.64,34.26,"Paramedic",false },
	{ -254.64,6326.95,32.82,"Paramedic",false }, 
	{ 2525.5,-342.68,101.89,"Police",false }, -- Tática
	{ -424.32,1083.17,327.68,"Police",false }, -- Militar
	{ -948.48,-2039.81,9.4,"Police",false }, -- SPEED
    {950.66,-978.35,39.75,"Mechanic",false}, -- Mecânica SportRace
    {-1410.44,-438.97,35.91,"Mechanic",false}, -- Mecânica Hayes

--------------------------------------------------------------------------------------------------------------------------------------
-- EMPREGOS
-----------------------------------------------------------------------------------------------------------------------------------------
	{ -428.57,-1728.35,19.78,"Recycle",false },
	{ 180.55,2793.45,45.65,"Recycle",false },
	{ -195.79,6264.95,31.49,"Recycle",false },
	{ -622.45,-229.83,38.05,"Miners",false },
	{-1194.17,-892.74,13.88,"Burguershot",false},
	{ -1816.64,-1193.73,14.31,"Fishing",false },
	{ 1523.69,3782.48,34.51,"Fishing2",true },
	{ -695.56,5802.12,17.32,"Hunting",false },
	{ -679.13,5839.52,17.32,"Hunting2",false },
-----------------------------------------------------------------------------------------------------------------------------------------
-- ILEGAL (ALTERAR MAPA DO CRIMINAL)
-----------------------------------------------------------------------------------------------------------------------------------------
	{728.27,-1068.9,28.31,"credential",false},
	{ 707.39,-966.96,30.41,"Criminal",false },
	{ 716.34,-961.59,30.4,"Criminal2",false },
	{ 711.47,-969.85,30.4,"Criminal3",false },
	{ 713.21,-972.05,30.4,"Criminal4",false },
-----------------------------------------------------------------------------------------------------------------------------------------
-- EXTRAS
-----------------------------------------------------------------------------------------------------------------------------------------
	{ 563.19,2752.92,42.87,"Petz",false },
	{ -307.63,-164.17,40.42,"Imoveis",false },
	{ 1655.77,4874.38,42.04,"Imoveis",false },
	{ -1082.25,-247.52,37.76,"Premium",false },
	{-657.29,-857.64,24.5,"Eletronicos",false},
	{46.24,-1749.4,29.64,"MegaMall",false},
	{2747.9,3473.03,55.67,"MegaMall2",false},
-----------------------------------------------------------------------------------------------------------------------------------------
-- COMBUSTÍVEL
-----------------------------------------------------------------------------------------------------------------------------------------
    { 273.83,-1253.46,28.29,"Fuel",false},
	{ 273.83,-1261.29,28.29,"Fuel",false},
	{ 273.83,-1268.63,28.29,"Fuel",false},
	{ 265.06,-1253.46,28.29,"Fuel",false},
	{ 265.06,-1261.29,28.29,"Fuel",false},
	{ 265.06,-1268.63,28.29,"Fuel",false},
	{ 256.43,-1253.46,28.29,"Fuel",false},
	{ 256.43,-1261.29,28.29,"Fuel",false},
	{ 256.43,-1268.63,28.29,"Fuel",false},
	{ 2680.90,3266.40,54.39,"Fuel",false},
	{ 2678.51,3262.33,54.39,"Fuel",false},
	{ -2104.53,-311.01,12.16,"Fuel",false},
	{ -2105.39,-319.21,12.16,"Fuel",false},
	{ -2106.06,-325.57,12.16,"Fuel",false},
	{ -2097.48,-326.48,12.16,"Fuel",false},
	{ -2096.81,-320.11,12.16,"Fuel",false},
	{ -2096.09,-311.90,12.16,"Fuel",false},
	{ -2087.21,-312.81,12.16,"Fuel",false},
	{ -2088.08,-321.03,12.16,"Fuel",false},
	{ -2088.75,-327.39,12.16,"Fuel",false},
	{ -2551.39,2327.11,32.24,"Fuel",false},
	{ -2558.02,2326.70,32.24,"Fuel",false},
	{ -2558.48,2334.13,32.24,"Fuel",false},
	{ -2552.60,2334.46,32.24,"Fuel",false},
	{ -2558.77,2341.48,32.24,"Fuel",false},
	{ -2552.39,2341.89,32.24,"Fuel",false},
	{ 186.97,6606.21,31.06,"Fuel",false},
	{ 179.67,6604.93,31.06,"Fuel",false},
	{ 172.33,6603.63,31.06,"Fuel",false},
	{ 818.99,-1026.24,25.44,"Fuel",false},
	{ 810.7,-1026.24,25.44,"Fuel",false},
	{ 810.7,-1030.94,25.44,"Fuel",false},
	{ 818.99,-1030.94,25.44,"Fuel",false},
	{ 818.99,-1026.24,25.44,"Fuel",false},
	{ 827.3,-1026.24,25.64,"Fuel",false},
	{ 827.3,-1030.94,25.64,"Fuel",false},
	{ 1207.07,-1398.16,34.39,"Fuel",false},
	{ 1204.2,-1401.03,34.39,"Fuel",false},
	{ 1210.07,-1406.9,34.39,"Fuel",false},
	{ 1212.94,-1404.03,34.39,"Fuel",false},
	{ 1178.97,-339.54,68.37,"Fuel",false},
	{ 1186.4,-338.23,68.36,"Fuel",false},
	{ 1184.89,-329.7,68.31,"Fuel",false},
	{ 1177.46,-331.01,68.32,"Fuel",false},
	{ 1175.71,-322.3,68.36,"Fuel",false},
	{ 1183.13,-320.99,68.36,"Fuel",false},
	{ 629.64,263.84,102.27,"Fuel",false},
	{ 629.64,273.97,102.27,"Fuel",false},
	{ 620.99,273.97,102.27,"Fuel",false},
	{ 621.0,263.84,102.27,"Fuel",false},
	{ 612.44,263.84,102.27,"Fuel",false},
	{ 612.43,273.96,102.27,"Fuel",false},
	{ 2588.41,358.56,107.66,"Fuel",false},
	{ 2588.65,364.06,107.66,"Fuel",false},
	{ 2581.18,364.39,107.66,"Fuel",false},
	{ 2580.94,358.89,107.66,"Fuel",false},
	{ 2573.55,359.21,107.66,"Fuel",false},
	{ 2573.79,364.71,107.66,"Fuel",false},
	{ 174.99,-1568.44,28.33,"Fuel",false},
	{ 181.81,-1561.96,28.33,"Fuel",false},
	{ 176.03,-1555.91,28.33,"Fuel",false},
	{ 169.3,-1562.26,28.33,"Fuel",false},
	{ -329.81,-1471.63,29.73,"Fuel",false},
	{ -324.74,-1480.41,29.73,"Fuel",false},
	{ -317.26,-1476.09,29.73,"Fuel",false},
	{ -322.33,-1467.31,29.73,"Fuel",false},
	{ -314.92,-1463.03,29.73,"Fuel",false},
	{ -309.85,-1471.79,29.73,"Fuel",false},
	{ 1786.08,3329.86,40.42,"Fuel",false},
	{ 1785.04,3331.48,40.35,"Fuel",false},
	{ 50.31,2778.54,57.05,"Fuel",false},
	{ 48.92,2779.59,57.05,"Fuel",false},
	{ 264.98,2607.18,43.99,"Fuel",false},
	{ 263.09,2606.8,43.99,"Fuel",false},
	{ 1035.45,2674.44,38.71,"Fuel",false},
	{ 1043.22,2674.45,38.71,"Fuel",false},
	{ 1043.22,2667.92,38.71,"Fuel",false},
	{ 1035.45,2667.91,38.71,"Fuel",false},
	{ 1209.59,2658.36,36.9,"Fuel",false},
	{ 1208.52,2659.43,36.9,"Fuel",false},
	{ 1205.91,2662.05,36.9,"Fuel",false},
	{ 2539.8,2594.81,36.96,"Fuel",false},
	{ 2001.55,3772.21,31.4,"Fuel",false},
	{ 2003.92,3773.48,31.4,"Fuel",false},
	{ 2006.21,3774.96,31.4,"Fuel",false},
	{ 2009.26,3776.78,31.4,"Fuel",false},
	{ 1684.6,4931.66,41.23,"Fuel",false},
	{ 1690.1,4927.81,41.23,"Fuel",false},
	{ 1705.74,6414.61,31.77,"Fuel",false},
	{ 1701.73,6416.49,31.77,"Fuel",false},
	{ 1697.76,6418.35,31.77,"Fuel",false},
	{ -97.06,6416.77,30.65,"Fuel",false},
	{ -91.29,6422.54,30.65,"Fuel",false},
	{ -1808.71,799.96,137.69,"Fuel",false},
	{ -1803.62,794.4,137.69,"Fuel",false},
	{ -1797.22,800.56,137.66,"Fuel",false},
	{ -1802.31,806.12,137.66,"Fuel",false},
	{ -1795.93,811.97,137.7,"Fuel",false},
	{ -1790.83,806.41,137.7,"Fuel",false},
	{ -1438.07,-268.69,45.41,"Fuel",false},
	{ -1444.5,-274.23,45.41,"Fuel",false},
	{ -1435.5,-284.68,45.41,"Fuel",false},
	{ -1429.07,-279.15,45.41,"Fuel",false},
	{ -732.64,-932.51,18.22,"Fuel",false},
	{ -732.64,-939.32,18.22,"Fuel",false},
	{ -724.0,-939.32,18.22,"Fuel",false},
	{ -724.0,-932.51,18.22,"Fuel",false},
	{ -715.43,-932.51,18.22,"Fuel",false},
	{ -715.43,-939.32,18.22,"Fuel",false},
	{ -532.28,-1212.71,17.33,"Fuel",false},
	{ -529.51,-1213.96,17.33,"Fuel",false},
	{ -524.92,-1216.15,17.33,"Fuel",false},
	{ -522.23,-1217.42,17.33,"Fuel",false},
	{ -518.52,-1209.5,17.33,"Fuel",false},
	{ -521.21,-1208.23,17.33,"Fuel",false},
	{ -525.8,-1206.04,17.33,"Fuel",false},
	{ -528.57,-1204.8,17.33,"Fuel",false},
	{ -72.03,-1765.1,28.53,"Fuel",false},
	{ -69.45,-1758.01,28.55,"Fuel",false},
	{ -77.59,-1755.05,28.81,"Fuel",false},
	{ -80.17,-1762.14,28.8,"Fuel",false},
	{ -63.61,-1767.93,28.27,"Fuel",false},
	{ -61.03,-1760.85,28.31,"Fuel",false},

}
-----------------------------------------------------------------------------------------------------------------------------------------
-- SHOPINFOS
-----------------------------------------------------------------------------------------------------------------------------------------
local shopInfos = {
	["1"] = {
		{
			event = "shops:openSystem",
			label = "Abrir",
			tunnel = "shop"
		},{
			event = "crafting:ammunationStore",
			label = "Criar",
			tunnel = "shop"
		}
	},
	["2"] = {
		{
			event = "shops:openSystem",
			label = "Abrir",
			tunnel = "shop"
		}
	},
	["3"] = {
		{
			event = "shops:openSystem",
			label = "Abrir",
			tunnel = "shop"
		},
		{
			event = "felp:pegarmangueira",
			label = "Mangueira",
			tunnel = "client"
		}
	}
}
-----------------------------------------------------------------------------------------------------------------------------------------
-- INFORMATIONS
-----------------------------------------------------------------------------------------------------------------------------------------
function Informations(shopName)
	if shopName == "ammunationStoreStore" then
		return shopInfos["1"]
	end

	if shopName == 'Fuel' then
		return shopInfos["3"]
	end

	return shopInfos["2"]
end
-----------------------------------------------------------------------------------------------------------------------------------------
-- THREADTARGET
-----------------------------------------------------------------------------------------------------------------------------------------
Citizen.CreateThread(function()
	SetNuiFocus(false,false)

	for k,v in pairs(shopList) do
		exports["target"]:AddCircleZone("Shops:"..k,vector3(v[1],v[2],v[3]),0.75,{
			name = "Shops:"..k,
			heading = 3374176
		},{
			shop = k,
			distance = 1.75,
			options = Informations(v[4])
		})
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- SHOPS:OPENSYSTEM
-----------------------------------------------------------------------------------------------------------------------------------------
AddEventHandler("shops:openSystem",function(shopId)
	if vSERVER.requestPerm(shopList[shopId][4]) and MumbleIsConnected() then
		SetNuiFocus(true,true)
		SendNUIMessage({ action = "showNUI", name = shopList[shopId][4], type = vSERVER.getShopType(shopList[shopId][4]) })

		if shopList[shopId][5] then
			TriggerEvent("sounds:source","shop",0.5)
		end
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- SHOPS:COFFEEMACHINE
-----------------------------------------------------------------------------------------------------------------------------------------
AddEventHandler("shops:coffeeMachine",function()
	if MumbleIsConnected() then
		SendNUIMessage({ action = "showNUI", name = "coffeeMachine", type = "Buy" })
		SetNuiFocus(true,true)
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- SHOPS:SODAMACHINE
-----------------------------------------------------------------------------------------------------------------------------------------
AddEventHandler("shops:sodaMachine",function()
	if MumbleIsConnected() then
		SendNUIMessage({ action = "showNUI", name = "sodaMachine", type = "Buy" })
		SetNuiFocus(true,true)
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- SHOPS:DONUTMACHINE
-----------------------------------------------------------------------------------------------------------------------------------------
AddEventHandler("shops:donutMachine",function()
	if MumbleIsConnected() then
		SendNUIMessage({ action = "showNUI", name = "donutMachine", type = "Buy" })
		SetNuiFocus(true,true)
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- SHOPS:BURGERMACHINE
-----------------------------------------------------------------------------------------------------------------------------------------
AddEventHandler("shops:burgerMachine",function()
	if MumbleIsConnected() then
		SendNUIMessage({ action = "showNUI", name = "burgerMachine", type = "Buy" })
		SetNuiFocus(true,true)
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- SHOPS:HOTDOGMACHINE
-----------------------------------------------------------------------------------------------------------------------------------------
AddEventHandler("shops:hotdogMachine",function()
	if MumbleIsConnected() then
		SendNUIMessage({ action = "showNUI", name = "hotdogMachine", type = "Buy" })
		SetNuiFocus(true,true)
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- SHOPS:CHIHUAHUA
-----------------------------------------------------------------------------------------------------------------------------------------
AddEventHandler("shops:Chihuahua",function()
	if MumbleIsConnected() then
		SendNUIMessage({ action = "showNUI", name = "Chihuahua", type = "Buy" })
		SetNuiFocus(true,true)
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- SHOPS:WATERMACHINE
-----------------------------------------------------------------------------------------------------------------------------------------
AddEventHandler("shops:waterMachine",function()
	if MumbleIsConnected() then
		SendNUIMessage({ action = "showNUI", name = "waterMachine", type = "Buy" })
		SetNuiFocus(true,true)
	end
end)
-----------------------------------------------------------------------------------------------------------------------------------------
-- SHOPS:MEDICBAG
-----------------------------------------------------------------------------------------------------------------------------------------
AddEventHandler("shops:medicBag",function()
	if vSERVER.requestPerm("Paramedic") and MumbleIsConnected() then
		SetNuiFocus(true,true)
		SendNUIMessage({ action = "showNUI", name = "Paramedic", type = "Buy" })
	end
end)